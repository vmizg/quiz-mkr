<div
  class="flex flex-col xl:flex-row place-content-center gap-16 xl:gap-8 pb-12 w-full max-w-4xl xl:max-w-full"
  [style]="cssVars"
>
  <div class="flex flex-col gap-2 w-full xl:w-3/5">
    <sl-card>
      <div class="flex flex-row justify-between">
        <div class="flex flex-row items-center gap-4 text-2xl font-semibold">
          <ng-container *ngIf="loading">
            <sl-spinner></sl-spinner>
            <span>Loading...</span>
          </ng-container>
          <ng-container *ngIf="!loading && quizTitle">
            <span>{{ quizTitle }}</span>
            <!-- <sl-color-picker *ngIf="quizTitle" value="{{ quizColor }}" no-format-toggle (sl-change)="handleColorChange($event)">
                            {{ quizColor }}
                        </sl-color-picker> -->
            <sl-icon-button
              name="pencil"
              label="Edit quiz"
              (click)="handleEditQuiz()"
              class="edit-quiz-button"
            ></sl-icon-button>
          </ng-container>
        </div>
        <div class="flex flex-row gap-4 items-center text-l">
          <span>Q U I Z C R T</span>
          <sl-avatar style="line-height: 56px">
            <sl-icon slot="icon" name="asterisk" class="text-xl"></sl-icon>
          </sl-avatar>
        </div>
      </div>
    </sl-card>
    <sl-form (sl-submit)="handleAddQuestion($event)" #questionForm>
      <sl-card>
        <div slot="header" class="font-semibold">{{ existingQuestion ? 'Edit' : 'Add' }} a question</div>
        <div class="flex flex-col gap-4">
          <div class="flex flex-row gap-2">
            <sl-textarea
              class="w-full"
              autofocus
              name="title"
              label="Question statement"
              (sl-input)="handleEdit()"
              (paste)="handlePaste($event)"
              required
            >
            </sl-textarea>
            <sl-button *ngIf="!image" class="mt-6" (click)="uploader.click()" outline
              ><sl-icon name="image"></sl-icon
            ></sl-button>
            <div *ngIf="image" class="question-image relative m-auto ml-4">
              <img [src]="image" class="h-full max-h-64 m-auto" />
              <div class="absolute top-2 right-2 flex flex-row gap-2">
                <sl-button (click)="uploader.click()" size="small" circle><sl-icon name="pencil"></sl-icon></sl-button>
                <sl-button (click)="image = ''" size="small" circle><sl-icon name="x-lg"></sl-icon></sl-button>
              </div>
            </div>
            <input hidden type="file" accept="image/*" (change)="handleUploadImage($event)" #uploader />
          </div>
          <div *ngFor="let option of counter(totalOptions); let i = index" class="option-row" #questionOptions>
            <sl-button
              style="width: 6rem"
              type="{{ correctToggle.checked ? 'success' : 'neutral' }}"
              [outline]="!correctToggle.checked"
              (click)="correctToggle.checked = !correctToggle.checked; handleEdit()"
            >
              <sl-icon *ngIf="!correctToggle.checked" name="x-circle" label="incorrect" outline style="font-size: 1rem">
              </sl-icon>
              <sl-icon
                *ngIf="correctToggle.checked"
                name="check-circle"
                label="correct"
                outline
                style="font-size: 1rem"
              >
              </sl-icon>
              <span class="ml-2">{{ alphabet[i] }}.</span>
              <input [name]="'correct-' + i" type="checkbox" #correctToggle hidden />
            </sl-button>
            <sl-input
              style="width: 100%"
              label="{{ i === 0 ? 'Options' : '' }}"
              (sl-input)="handleEdit()"
              [name]="'option-' + i"
              #optionInput
              required
            ></sl-input>
            <sl-button
              style="width: 4rem"
              (click)="handleRemoveOption(optionInput)"
              [disabled]="totalOptions < 3"
              type="neutral"
              outline
              tabindex="-1"
            >
              <sl-icon name="trash"></sl-icon>
            </sl-button>
          </div>
          <div class="option-row add-option" *ngIf="totalOptions < 7">
            <sl-button class="w-full" (click)="handleAddOption()">Add a new option</sl-button>
          </div>
          <div>
            <sl-input label="Note on correct answer (optional)" name="answer-note" (sl-input)="handleEdit()"></sl-input>
          </div>
        </div>
      </sl-card>
      <sl-card>
        <div class="flex flex-row justify-between">
          <sl-button class="w-full" type="primary" submit>
            <sl-spinner *ngIf="adding" slot="prefix"></sl-spinner>
            {{
              adding
                ? existingQuestion
                  ? 'Saving...'
                  : 'Adding...'
                : existingQuestion
                ? 'Save question'
                : 'Add question'
            }}
          </sl-button>
        </div>
      </sl-card>
    </sl-form>
  </div>
  <div class="flex flex-col gap-2 w-full xl:w-2/5">
    <sl-card>
      <div class="flex flex-row justify-between items-center gap-4">
        <div class="flex flex-row items-center gap-4 text-2xl font-semibold">
          <span>Questions in quiz</span>
        </div>
        <div class="flex flex-row items-center gap-4 text-l">
          <sl-avatar style="line-height: 56px">
            <sl-icon slot="icon" name="question-circle" class="text-xl"></sl-icon>
          </sl-avatar>
        </div>
      </div>
    </sl-card>
    <cdk-virtual-scroll-viewport
      itemSize="5.5rem"
      class="question-list-container"
      *ngIf="questions && questions.length > 0"
    >
      <div class="flex flex-col gap-2">
        <sl-card *cdkVirtualFor="let q of questions; let i = index">
          <div class="flex flex-row items-center justify-between gap-4">
            <div class="question-title">
              <span>{{ i + 1 }}. {{ q.title }}</span>
              <span *ngIf="existingQuestion && q.id === existingQuestion.id" class="italic font-bold"> (editing)</span>
            </div>
            <div class="flex flex-row gap-2">
              <sl-button type="warning" circle outline (click)="handleEditQuestion(q)"
                ><sl-icon name="pencil-square"></sl-icon
              ></sl-button>
              <sl-button type="danger" circle outline (click)="handleDeleteQuestion(q)" tabindex="-1"
                ><sl-icon name="trash"></sl-icon
              ></sl-button>
            </div>
          </div>
        </sl-card>
      </div>
    </cdk-virtual-scroll-viewport>
    <sl-card *ngIf="!loading && (!questions || questions.length === 0)">
      <div class="flex flex-col text-gray-500">
        <span>You have not added any questions for this quiz yet.</span>
      </div>
    </sl-card>
  </div>
</div>
